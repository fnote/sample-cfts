{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Deployed via Notification-Service-Resources.json",
    "Parameters": {
        "PONumber": {
            "Description": "PO Number for billing",
            "Type": "String",
            "Default": "7000002358",
            "MinLength": "1",
            "MaxLength": "255",
            "AllowedPattern": "[\\x20-\\x7E]*",
            "ConstraintDescription": "Must contain only ASCII characters."
        },
        "ApplicationID": {
            "Description": "Application ID - Official Application_ID, this is generated by Sysco's CMDB",
            "Type": "String",
            "Default": "APP-001151",
            "MinLength": "1",
            "MaxLength": "255",
            "AllowedPattern": "[\\x20-\\x7E]*",
            "ConstraintDescription": "Must contain only ASCII characters."
        },
        "ApplicationName": {
            "Description": "Application_Name - Common, user-friendly name",
            "Type": "String",
            "Default": "Cloud Pricing",
            "MinLength": "1",
            "MaxLength": "255",
            "AllowedPattern": "[\\x20-\\x7E]*",
            "ConstraintDescription": "Must contain only ASCII characters."
        },
        "Approver": {
            "Description": "Person approving instance funding.  This should be Email address formatted",
            "Type": "String",
            "Default": "villanueva.loi@corp.sysco.com",
            "MinLength": "1",
            "MaxLength": "255"
        },
        "Owner": {
            "Description": "Email address usually Product/ Platform Owner, though team distribution list for technical product/platform team contact",
            "Type": "String",
            "Default": "krishan.senevirathne@sysco.com",
            "MinLength": "1",
            "MaxLength": "255"
        },
        "SupportEmail": {
            "Description": "Email distribution list for technical product/platform team contact",
            "Type": "String",
            "Default": "000-BT-PricingPlatform@Corp.sysco.com",
            "MinLength": "1",
            "MaxLength": "255"
        },
        "ProjectID": {
            "Description": "Project_ID - BT Project ID for this workload",
            "Type": "String",
            "Default": "BT.001176",
            "MinLength": "1",
            "MaxLength": "255",
            "AllowedPattern": "[\\x20-\\x7E]*",
            "ConstraintDescription": "Must contain only ASCII characters."
        },
        "2WTAGGER": {
            "Description": "Used by 2nd Watch Managed Services in shared accounts to determine if a resource is supported",
            "Type": "String",
            "Default": "team_managed",
            "MinLength": "1",
            "MaxLength": "255",
            "AllowedValues": [
                "team_managed",
                "adlm_managed",
                "2w_managed"
            ],
            "ConstraintDescription": "Must contain only ASCII characters."
        },
        "Environment": {
            "Description": "Name of logical build environment designated for service.",
            "Type": "String",
            "Default": "Execution",
            "AllowedValues": [
                "Development",
                "Quality",
                "Staging",
                "Tuning",
                "Execution",
                "Production"
            ],
            "ConstraintDescription": "Must be a valid environment."
        },
        "EnvironmentShort": {
            "Description": "Environment for application",
            "Type": "String",
            "Default": "EXE",
            "AllowedValues": [
                "DEV",
                "QA",
                "STG",
                "EXE",
                "PROD"
            ],
            "ConstraintDescription": "Must be a valid environment."
        },
        "HashKeyElementName": {
            "Description": "HashType PrimaryPartitionKey Name",
            "Type": "String",
            "Default": "applicationEvent",
            "AllowedPattern": "[a-zA-Z0-9]*",
            "MinLength": "1",
            "MaxLength": "2048",
            "ConstraintDescription": "must contain only alphanumberic characters"
        },
        "HashKeyElementType": {
            "Description": "HashType PrimaryPartitionKey Type",
            "Type": "String",
            "Default": "S",
            "AllowedPattern": "[S|N]",
            "MinLength": "1",
            "MaxLength": "1",
            "ConstraintDescription": "must be either S or N"
        },
        "RangeKeyElementName": {
            "Description": "RangeType PrimarySortKey Name",
            "Type": "String",
            "Default": "triggeredTime",
            "AllowedPattern": "[a-zA-Z0-9]*",
            "MinLength": "1",
            "MaxLength": "2048",
            "ConstraintDescription": "must contain only alphanumberic characters"
        },
        "RangeKeyElementType": {
            "Description": "RangeType PrimarySortKey Type",
            "Type": "String",
            "Default": "N",
            "AllowedPattern": "[S|N]",
            "MinLength": "1",
            "MaxLength": "1",
            "ConstraintDescription": "must be either S or N"
        },
        "ReadCapacityUnits": {
            "Description": "Provisioned read throughput",
            "Type": "Number",
            "Default": "5",
            "MinValue": "5",
            "MaxValue": "10000",
            "ConstraintDescription": "must be between 5 and 10000"
        },
        "WriteCapacityUnits": {
            "Description": "Provisioned write throughput",
            "Type": "Number",
            "Default": "1",
            "MinValue": "1",
            "MaxValue": "10000",
            "ConstraintDescription": "must be between 1 and 10000"
        }
    },
    "Resources": {
        "CpNotificationServiceTopic": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
                "TopicName": {
                    "Fn::Join": [
                        "",
                        [
                            "CP-Notification-Service-Topic-",
                            {
                                "Ref": "EnvironmentShort"
                            }
                        ]
                    ]
                }
            }
        },
        "CpNotificationServiceBackupQueue": {
            "Type": "AWS::SQS::Queue",
            "Properties": {
                "QueueName": {
                    "Fn::Join": [
                        "",
                        [
                            "CP-Notification-Service-Backup-Queue-",
                            {
                                "Ref": "EnvironmentShort"
                            }
                        ]
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    "CP-Notification-Service-Backup-Queue-",
                                    {
                                        "Ref": "EnvironmentShort"
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Technical:ApplicationName",
                        "Value": {
                            "Ref": "ApplicationName"
                        }
                    },
                    {
                        "Key": "Technical:ApplicationID",
                        "Value": {
                            "Ref": "ApplicationID"
                        }
                    },
                    {
                        "Key": "Technical:PlatformOwner",
                        "Value": {
                            "Ref": "Owner"
                        }
                    },
                    {
                        "Key": "Technical:Environment",
                        "Value": {
                            "Ref": "Environment"
                        }
                    },
                    {
                        "Key": "Technical:ApplicationSubName",
                        "Value": "Notification Service"
                    },
                    {
                        "Key": "Technical:ApplicationRole",
                        "Value": "SQS"
                    },
                    {
                        "Key": "Support_Email",
                        "Value": {
                            "Ref": "SupportEmail"
                        }
                    },
                    {
                        "Key": "Approver",
                        "Value": {
                            "Ref": "Approver"
                        }
                    },
                    {
                        "Key": "PO_Number",
                        "Value": {
                            "Ref": "PONumber"
                        }
                    },
                    {
                        "Key": "Project_ID",
                        "Value": {
                            "Ref": "ProjectID"
                        }
                    },
                    {
                        "Key": "2WTAGGER",
                        "Value": {
                            "Ref": "2WTAGGER"
                        }
                    },
                    {
                        "Key": "Component",
                        "Value": "Notification Service"
                    }
                ]
            }
        },
        "SnsSubscription": {
            "Type": "AWS::SNS::Subscription",
            "Properties": {
                "TopicArn": {
                    "Ref": "CpNotificationServiceTopic"
                },
                "Endpoint": {
                    "Fn::GetAtt": [
                        "CpNotificationServiceBackupQueue",
                        "Arn"
                    ]
                },
                "Protocol": "sqs",
                "RawMessageDelivery": "true"
            }
        },
        "ResourceQueuePolicy": {
            "Type": "AWS::SQS::QueuePolicy",
            "Properties": {
                "PolicyDocument": {
                    "Id": "QueuePolicy",
                    "Statement": [
                        {
                            "Sid": "Allow-SendMessage-To-Queue-From-SNS-Topic",
                            "Effect": "Allow",
                            "Principal": {
                                "AWS": "*"
                            },
                            "Action": [
                                "sqs:SendMessage"
                            ],
                            "Resource": {
                                "Fn::GetAtt": [
                                    "CpNotificationServiceBackupQueue",
                                    "Arn"
                                ]
                            },
                            "Condition": {
                                "ArnEquals": {
                                    "aws:SourceArn": {
                                        "Ref": "CpNotificationServiceTopic"
                                    }
                                }
                            }
                        }
                    ]
                },
                "Queues": [
                    {
                        "Ref": "CpNotificationServiceBackupQueue"
                    }
                ]
            }
        },
        "CpNotificationServiceDynamoDBTable": {
            "Type": "AWS::DynamoDB::Table",
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": {
                            "Ref": "HashKeyElementName"
                        },
                        "AttributeType": {
                            "Ref": "HashKeyElementType"
                        }
                    },
                    {
                        "AttributeName": {
                            "Ref": "RangeKeyElementName"
                        },
                        "AttributeType": {
                            "Ref": "RangeKeyElementType"
                        }
                    }
                ],
                "KeySchema": [
                    {
                        "AttributeName": {
                            "Ref": "HashKeyElementName"
                        },
                        "KeyType": "HASH"
                    },
                    {
                        "AttributeName": {
                            "Ref": "RangeKeyElementName"
                        },
                        "KeyType": "RANGE"
                    }
                ],
                "ProvisionedThroughput": {
                    "ReadCapacityUnits": {
                        "Ref": "ReadCapacityUnits"
                    },
                    "WriteCapacityUnits": {
                        "Ref": "WriteCapacityUnits"
                    }
                },
                "TableName": {
                    "Fn::Join": [
                        "",
                        [
                            "CP_Notification_Service_Table_",
                            {
                                "Ref": "EnvironmentShort"
                            }
                        ]
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    "CP_Notification_Service_Table_",
                                    {
                                        "Ref": "EnvironmentShort"
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Technical:ApplicationName",
                        "Value": {
                            "Ref": "ApplicationName"
                        }
                    },
                    {
                        "Key": "Technical:ApplicationID",
                        "Value": {
                            "Ref": "ApplicationID"
                        }
                    },
                    {
                        "Key": "Technical:PlatformOwner",
                        "Value": {
                            "Ref": "Owner"
                        }
                    },
                    {
                        "Key": "Technical:Environment",
                        "Value": {
                            "Ref": "Environment"
                        }
                    },
                    {
                        "Key": "Technical:ApplicationSubName",
                        "Value": "Notification Service"
                    },
                    {
                        "Key": "Technical:ApplicationRole",
                        "Value": "Database Table"
                    },
                    {
                        "Key": "Support_Email",
                        "Value": {
                            "Ref": "SupportEmail"
                        }
                    },
                    {
                        "Key": "Approver",
                        "Value": {
                            "Ref": "Approver"
                        }
                    },
                    {
                        "Key": "PO_Number",
                        "Value": {
                            "Ref": "PONumber"
                        }
                    },
                    {
                        "Key": "Project_ID",
                        "Value": {
                            "Ref": "ProjectID"
                        }
                    },
                    {
                        "Key": "2WTAGGER",
                        "Value": {
                            "Ref": "2WTAGGER"
                        }
                    },
                    {
                        "Key": "Component",
                        "Value": "Notification Service"
                    }
                ]
            }
        }
    },
    "Outputs": {
        "CpNotificationServiceTopicTopicARN": {
            "Value": {
                "Ref": "CpNotificationServiceTopic"
            },
            "Description": "Topic ARN of newly created SNS topic"
        },
        "CpNotificationServiceBackupQueueInfo": {
            "Value": {
                "Fn::Join": [
                    " ",
                    [
                        "ARN:",
                        {
                            "Fn::GetAtt": [
                                "CpNotificationServiceBackupQueue",
                                "Arn"
                            ]
                        },
                        "URL:",
                        {
                            "Ref": "CpNotificationServiceBackupQueue"
                        }
                    ]
                ]
            },
            "Description": "CpNotificationServiceBackupQueue details"
        },
        "CpNotificationServiceDynamoDBTable": {
            "Value": {
                "Ref": "CpNotificationServiceDynamoDBTable"
            },
            "Description": "Name of the newly created DynamoDB table"
        }
    }
}